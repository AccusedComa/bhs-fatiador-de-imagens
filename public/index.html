<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <title>BHS - Fatiador de imagens</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: radial-gradient(circle at top left, #eff6ff, #f9fafb);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
    }
    .card {
      width: 100%;
      max-width: 540px;
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.15);
      padding: 1.75rem 1.75rem 1.5rem;
    }
    h1 {
      margin: 0 0 0.5rem;
      font-size: 1.6rem;
      letter-spacing: -0.03em;
      color: #0f172a;
    }
    p {
      margin: 0 0 1.25rem;
      font-size: 0.95rem;
      color: #4b5563;
    }
    label {
      display: block;
      font-size: 0.85rem;
      font-weight: 500;
      color: #374151;
      margin-bottom: 0.3rem;
    }
    input[type="file"],
    input[type="number"] {
      width: 100%;
      font-size: 0.95rem;
      padding: 0.55rem 0.7rem;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
    }
    input[type="file"]:focus,
    input[type="number"]:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.15);
    }
    input.readonly {
      background-color: #f3f4f6;
      color: #6b7280;
      cursor: default;
    }
    .field {
      margin-bottom: 0.9rem;
    }
    .grid-row {
      display: flex;
      gap: 0.75rem;
    }
    .grid-row .field {
      flex: 1;
      margin-bottom: 0;
    }
    .helper {
      font-size: 0.8rem;
      color: #6b7280;
      margin-top: 0.25rem;
    }
    .checkbox-row {
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
      margin-top: 0.3rem;
    }
    .checkbox-row input[type="checkbox"] {
      margin-top: 0.1rem;
    }
    button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-top: 1.2rem;
      width: 100%;
      border: none;
      border-radius: 999px;
      padding: 0.65rem 1rem;
      font-size: 0.95rem;
      font-weight: 600;
      color: #ffffff;
      background: linear-gradient(135deg, #2563eb, #4f46e5);
      cursor: pointer;
      box-shadow: 0 12px 25px rgba(37, 99, 235, 0.35);
      transition: transform 0.12s ease, box-shadow 0.12s ease, opacity 0.12s ease;
    }
    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 18px 30px rgba(37, 99, 235, 0.3);
    }
    button:active {
      transform: translateY(0);
      box-shadow: 0 10px 18px rgba(37, 99, 235, 0.25);
    }
    button:disabled {
      opacity: 0.65;
      cursor: default;
      box-shadow: none;
      transform: none;
    }
    .status {
      margin-top: 0.9rem;
      font-size: 0.85rem;
      color: #6b7280;
      min-height: 1.2em;
    }
    .status.error {
      color: #b91c1c;
    }
    .status.success {
      color: #15803d;
    }
    small {
      display: block;
      margin-top: 0.4rem;
      font-size: 0.75rem;
      color: #9ca3af;
    }
  </style>
</head>
<body>
  <main class="card">
    <h1>BHS – Fatiador de imagens</h1>
    <p>Envie uma imagem, escolha o número de linhas e colunas ou use o modo Instagram 3x3, e baixe as fatias em um ZIP.</p>

    <form id="slice-form" action="/slice" method="post" enctype="multipart/form-data">
      <div class="field">
        <label for="image">Imagem (PNG/JPG)</label>
        <input type="file" id="image" name="image" accept="image/*" required />
        <div class="helper">A imagem será processada localmente neste computador.</div>
      </div>

      <div class="grid-row">
        <div class="field">
          <label for="rows">Linhas</label>
          <input type="number" id="rows" name="rows" min="1" step="1" required />
        </div>
        <div class="field">
          <label for="cols">Colunas</label>
          <input type="number" id="cols" name="cols" min="1" step="1" required />
        </div>
      </div>

      <div class="field">
        <div class="checkbox-row">
          <input type="checkbox" id="instagramMode" name="instagramMode" />
          <div>
            <label for="instagramMode">Modo Instagram (feed em grade 3x3)</label>
            <div class="helper">Recorta a imagem para um quadrado central e gera 9 fatias quadradas alinhadas para o grid.</div>
          </div>
        </div>
      </div>

      <button type="submit" id="submit-btn">
        Fatiar imagem
      </button>

      <div id="status" class="status"></div>
      <small>Após o processamento, o navegador fará o download de um arquivo ZIP com todas as fatias.</small>
    </form>
  </main>

  <script>
    const form = document.getElementById('slice-form');
    const statusEl = document.getElementById('status');
    const submitBtn = document.getElementById('submit-btn');
    const rowsInput = document.getElementById('rows');
    const colsInput = document.getElementById('cols');
    const instagramCheckbox = document.getElementById('instagramMode');

    function syncInstagramMode() {
      if (instagramCheckbox.checked) {
        rowsInput.value = 3;
        colsInput.value = 3;
        rowsInput.readOnly = true;
        colsInput.readOnly = true;
        rowsInput.classList.add('readonly');
        colsInput.classList.add('readonly');
      } else {
        rowsInput.readOnly = false;
        colsInput.readOnly = false;
        rowsInput.classList.remove('readonly');
        colsInput.classList.remove('readonly');
      }
    }

    instagramCheckbox.addEventListener('change', syncInstagramMode);
    syncInstagramMode();

    form.addEventListener('submit', function () {
      statusEl.textContent = 'Processando imagem...';
      statusEl.className = 'status';
      submitBtn.disabled = true;
      setTimeout(() => {
        submitBtn.disabled = false;
        statusEl.textContent = 'Se nada acontecer, verifique se o navegador bloqueou o download.';
      }, 1500);
    });
  </script>
</body>
</html>

